<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=no">
    <title>JWST Central Molecular Zone Tour</title>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src='https://aladin.cds.unistra.fr/AladinLite/api/v3/latest/aladin.js' charset='utf-8'></script>
    <!-- Add draggable functionality -->
    <script type="text/javascript" src="draggable.js"></script>
    <script type="text/javascript" src="tour-common.js"></script>
    <link rel="stylesheet" href="default.css">
    <link rel="stylesheet" href="draggable.css">
    <link rel="stylesheet" href="tour-common.css">
</head>

<body>
    <div id="aladin-lite-div"></div>

    <div id="loading-div">Loading JWST Central Molecular Zone Tour... Please wait.</div>

    <div id="waypoint-info">
        <div id="waypoint-header">
            <button id="expand-btn" title="Expand/Collapse Info">â–¶</button>
            <h2 id="waypoint-title">Welcome to the JWST Central Molecular Zone Tour</h2>
        </div>
        <div id="waypoint-content">
            <p id="waypoint-description">
            This is a comprehensive tour through the Central Molecular Zone and key astronomical objects as seen with JWST and other observatories. Click "Start Tour" to begin exploring these fascinating regions of our Galaxy.
            </p>
        </div>
    </div>

    <div id="progress-container">
        <div id="progress-bar">
            <div id="progress"></div>
        </div>
        <span id="current-waypoint">0</span>
    </div>

    <div id="tour-controls">
        <button id="prev-btn" title="Previous">â€¹</button>
        <button id="next-btn" title="Next">â€º</button>
        <button id="start-btn" title="Start/Play Tour">â–¶</button>
        <button id="reset-btn" title="Reset">âŸ²</button>
        <button id="share-btn" title="Copy shareable link to current waypoint">ðŸ”—</button>
        <select id="waypoint-dropdown" title="Jump to waypoint"
            style="background-color: #2962FF; color: white; border: none; padding: 12px 6px; border-radius: 8px; margin: 0 3px; cursor: pointer; font-size: 16px; position: relative; z-index: 120; width: 36px; text-align: center; -webkit-appearance: none; -moz-appearance: none; appearance: none;">
            <option value="">â‰«</option>
        </select>
        <select id="speed-dropdown" title="Tour speed: 1Ã— = normal, 2Ã— = double speed, 4Ã— = quadruple speed"
            style="background-color: #2962FF; color: white; border: none; padding: 12px 6px; border-radius: 8px; margin: 0 3px; cursor: pointer; font-size: 16px; position: relative; z-index: 120; width: 42px; text-align: center; -webkit-appearance: none; -moz-appearance: none; appearance: none;">
            <option value="1" selected>1Ã—</option>
            <option value="2">2Ã—</option>
            <option value="4">4Ã—</option>
        </select>
    </div>

    <div id="countdown-timer" style="display: none;">
        <span id="countdown-text">Next in: </span>
        <span id="countdown-value">5</span>
    </div>

    <script>
        // Load waypoints from JSON file
        let waypoints = [];

        // Function to load waypoints from JSON file
        async function loadWaypoints() {
            try {
                const response = await fetch('waypoints_jwst.json');
                const data = await response.json();
                waypoints = data.waypoints;

                // Process waypoints to add getImageUrl() calls where needed
                waypoints.forEach(waypoint => {
                    if (waypoint.url && !waypoint.url.startsWith('http')) {
                        waypoint.url = getImageUrl(waypoint.url);
                    }
                    if (waypoint.fade_layer && !waypoint.fade_layer.startsWith('http')) {
                        waypoint.fade_layer = getImageUrl(waypoint.fade_layer);
                    }
                });

                console.log('Loaded waypoints:', waypoints);

                // Initialize the tour after waypoints are loaded
                initializeTour(waypoints, {
                    initialSurvey: getImageUrl('rgb_final_uncropped_hips')
                });
            } catch (error) {
                console.error('Error loading waypoints:', error);
                // Fallback: show error message
                document.getElementById('loading-div').innerHTML = 'Error loading tour waypoints. Please check that waypoints_jwst.json is available.';
            }
        }

        // Initialize the tour when the page is loaded
        document.addEventListener('DOMContentLoaded', function () {
            loadWaypoints();
        });
    </script>
</body>

</html>